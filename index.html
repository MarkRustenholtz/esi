<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fiche ESI</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f0f0f0; }
    h2 { background-color: #004080; color: white; padding: 10px; border-radius: 5px; }
    form { background: white; padding: 20px; border-radius: 5px; max-width: 600px; margin: auto; }
    label { display: block; margin-top: 10px; }
    input, select { width: 100%; padding: 8px; margin-top: 5px; }
    button { margin-top: 10px; padding: 8px 15px; background-color: #004080; color: white; border: none; border-radius: 5px; cursor: pointer; }
    button:hover { background-color: #0066cc; }
    .fiche { background: white; padding: 10px; border-radius: 5px; margin-top: 10px; }
    .date-naissance { display: flex; gap: 5px; }
    .date-naissance input { flex: 1; }
    .btn-danger { background-color: #cc0000; }
    .btn-danger:hover { background-color: #ff3333; }
</style>
</head>
<body>

<h1>Application Fiche ESI</h1>

<form id="ficheForm">
    <h2>Identité</h2>
    <label>Nom<input type="text" id="nom" autocomplete="off" required></label>
    <label>Prénom<input type="text" id="prenom" autocomplete="off" required></label>
    <label>Sexe
        <select id="sexe">
            <option value="">--Sélectionner--</option>
            <option value="Masculin">Masculin</option>
            <option value="Féminin">Féminin</option>
            <option value="Autre">Autre</option>
        </select>
    </label>
    <label>Nationalité<input type="text" id="nationalite" autocomplete="off"></label>
    
    <label>Date de naissance :</label>
    <div class="date-naissance">
        <input type="number" id="jour" placeholder="JJ" min="1" max="31" required>
        <input type="number" id="mois" placeholder="MM" min="1" max="12" required>
        <input type="number" id="annee" placeholder="AAAA" min="1900" max="2100" required>
    </div>
    <label>Âge<input type="number" id="age" readonly></label>

    <h2>Voyage</h2>
    <label>Ville de départ<input type="text" id="villeDepart" autocomplete="off"></label>
    <label>Pays de départ<input type="text" id="paysDepart" autocomplete="off"></label>
    <label>Ville de destination<input type="text" id="villeDestination" autocomplete="off"></label>
    <label>Pays de destination<input type="text" id="paysDestination" autocomplete="off"></label>

    <h2>Intervention</h2>
    <label>Heure et Date<input type="text" id="heureDate" readonly></label>
    <label>Lieu d'interpellation<input type="text" id="lieuInterpellation" autocomplete="off"></label>

    <h2>Véhicule</h2>
    <label>Type de véhicule<input type="text" id="vehicule" autocomplete="off"></label>
    <label>Immatriculation<input type="text" id="immatriculation" autocomplete="off"></label>

    <h2>Pièces d'identité présentées</h2>
    <div id="piecesIdentite">
        <label><input type="checkbox" name="piece" value="Passeport valide"> Passeport valide</label>
        <label><input type="checkbox" name="piece" value="Passeport périmé"> Passeport périmé</label>
        <label><input type="checkbox" name="piece" value="Fiche de demande d'asile valide"> Fiche de demande d'asile valide</label>
        <label><input type="checkbox" name="piece" value="Fiche de demande d'asile périmée"> Fiche de demande d'asile périmée</label>
        <label><input type="checkbox" name="piece" value="Carte d'identité valide"> Carte d'identité valide</label>
        <label><input type="checkbox" name="piece" value="Carte d'identité périmée"> Carte d'identité périmée</label>
        <label><input type="checkbox" name="piece" value="Titre de séjour valide"> Titre de séjour valide</label>
        <label><input type="checkbox" name="piece" value="Titre de séjour périmé"> Titre de séjour périmé</label>
    </div>

    <button type="submit">Enregistrer la fiche</button>
</form>

<h2>Historique des fiches</h2>
<div id="historique"></div>
<button id="effacerFiches" class="btn-danger">Effacer toutes les fiches</button>

<script>
// Heure et date auto
function setHeureDate() {
    const now = new Date();
    const h = now.getHours().toString().padStart(2,'0');
    const m = now.getMinutes().toString().padStart(2,'0');
    const s = now.getSeconds().toString().padStart(2,'0');
    const j = now.getDate().toString().padStart(2,'0');
    const mois = (now.getMonth()+1).toString().padStart(2,'0');
    const a = now.getFullYear();
    document.getElementById('heureDate').value = `${h}:${m}:${s} - ${j}/${mois}/${a}`;
}
setHeureDate();
setInterval(setHeureDate, 1000);

// Calcul âge
function calculerAge() {
    const jour = parseInt(document.getElementById("jour").value);
    const mois = parseInt(document.getElementById("mois").value) - 1;
    const annee = parseInt(document.getElementById("annee").value);
    if (!jour || !mois || !annee) return;
    const today = new Date();
    const naissance = new Date(annee, mois, jour);
    let age = today.getFullYear() - naissance.getFullYear();
    const m = today.getMonth() - naissance.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < naissance.getDate())) age--;
    document.getElementById("age").value = age;
}

// Auto passage aux champs suivants
function autoNext(input, nextInputId, maxLength) {
    input.addEventListener('input', function() {
        if (this.value.length >= maxLength) {
            document.getElementById(nextInputId).focus();
        }
        calculerAge();
    });
}
autoNext(document.getElementById('jour'), 'mois', 2);
autoNext(document.getElementById('mois'), 'annee', 2);
document.getElementById('annee').addEventListener('input', calculerAge);

// Enregistrement fiche
document.getElementById('ficheForm').addEventListener('submit', function(e){
    e.preventDefault();
    const pieces = Array.from(document.querySelectorAll('input[name="piece"]:checked')).map(cb => cb.value);
    const fiche = {
        nom: document.getElementById('nom').value,
        prenom: document.getElementById('prenom').value,
        sexe: document.getElementById('sexe').value,
        nationalite: document.getElementById('nationalite').value,
        jour: document.getElementById('jour').value,
        mois: document.getElementById('mois').value,
        annee: document.getElementById('annee').value,
        age: document.getElementById('age').value,
        villeDepart: document.getElementById('villeDepart').value,
        paysDepart: document.getElementById('paysDepart').value,
        villeDestination: document.getElementById('villeDestination').value,
        paysDestination: document.getElementById('paysDestination').value,
        heureDate: document.getElementById('heureDate').value,
        lieuInterpellation: document.getElementById('lieuInterpellation').value,
        vehicule: document.getElementById('vehicule').value,
        immatriculation: document.getElementById('immatriculation').value,
        piecesIdentite: pieces
    };
    const fiches = JSON.parse(localStorage.getItem('fichesESI') || '[]');
    fiches.push(fiche);
    localStorage.setItem('fichesESI', JSON.stringify(fiches));
    this.reset();
    setHeureDate();
    afficherHistorique();
});

// Affichage historique
function afficherHistorique() {
    const historiqueDiv = document.getElementById('historique');
    historiqueDiv.innerHTML = '';
    const fiches = JSON.parse(localStorage.getItem('fichesESI') || '[]');
    fiches.forEach((fiche, index) => {
        const ficheDiv = document.createElement('div');
        ficheDiv.className = 'fiche';
        ficheDiv.innerHTML = `
            <strong>Fiche #${index+1}</strong><br>
            Nom: ${fiche.nom} ${fiche.prenom} | Sexe: ${fiche.sexe} | Nationalité: ${fiche.nationalite} | Âge: ${fiche.age}<br>
            Départ: ${fiche.villeDepart}, ${fiche.paysDepart} | Destination: ${fiche.villeDestination}, ${fiche.paysDestination}<br>
            Heure et Date: ${fiche.heureDate} | Lieu: ${fiche.lieuInterpellation}<br>
            Véhicule: ${fiche.vehicule} | Immatriculation: ${fiche.immatriculation}<br>
            Pièces d'identité: ${fiche.piecesIdentite.join(", ")}<br>
            <button onclick="modifierFiche(${index})">Modifier</button>
            <button onclick="supprimerFiche(${index})" class="btn-danger">Supprimer</button>
        `;
        historiqueDiv.appendChild(ficheDiv);
    });
}

// Supprimer fiche individuelle
function supprimerFiche(index) {
    if (confirm("Voulez-vous vraiment supprimer cette fiche ?")) {
        const fiches = JSON.parse(localStorage.getItem('fichesESI') || '[]');
        fiches.splice(index, 1);
        localStorage.setItem('fichesESI', JSON.stringify(fiches));
        afficherHistorique();
    }
}

// Modifier fiche
function modifierFiche(index) {
    const fiches = JSON.parse(localStorage.getItem('fichesESI') || '[]');
    const fiche = fiches[index];

    document.getElementById('nom').value = fiche.nom;
    document.getElementById('prenom').value = fiche.prenom;
    document.getElementById('sexe').value = fiche.sexe;
    document.getElementById('nationalite').value = fiche.nationalite;
    document.getElementById('jour').value = fiche.jour;
    document.getElementById('mois').value = fiche.mois;
    document.getElementById('annee').value = fiche.annee;
    document.getElementById('age').value = fiche.age;
    document.getElementById('villeDepart').value = fiche.villeDepart;
    document.getElementById('paysDepart').value = fiche.paysDepart;
    document.getElementById('villeDestination').value = fiche.villeDestination;
    document.getElementById('paysDestination').value = fiche.paysDestination;
    document.getElementById('lieuInterpellation').value = fiche.lieuInterpellation;
    document.getElementById('vehicule').value = fiche.vehicule;
    document.getElementById('immatriculation').value = fiche.immatriculation;

    document.querySelectorAll('input[name="piece"]').forEach(cb => cb.checked = false);
    fiche.piecesIdentite.forEach(val => {
        const cb = Array.from(document.querySelectorAll('input[name="piece"]')).find(c => c.value === val);
        if (cb) cb.checked = true;
    });

    fiches.splice(index, 1);
    localStorage.setItem('fichesESI', JSON.stringify(fiches));
    afficherHistorique();
}

// Effacer toutes les fiches
document.getElementById('effacerFiches').addEventListener('click', function() {
    if (confirm("Voulez-vous vraiment effacer toutes les fiches ?")) {
        localStorage.removeItem('fichesESI');
        afficherHistorique();
        alert("Toutes les fiches ont été effacées !");
    }
});

// Affichage initial
afficherHistorique();
</script>

</body>
</html>
